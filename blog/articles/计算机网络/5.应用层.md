# 应用层

<!-- TOC -->

- [应用层](#应用层)
    - [HTTP的报文结构](#http的报文结构)
        - [起始行](#起始行)
        - [头部](#头部)
        - [空行](#空行)
        - [实体](#实体)
    - [HTTP请求方法](#http请求方法)
        - [常见方法](#常见方法)
        - [GET与POST区别](#get与post区别)
    - [URI](#uri)
        - [URI结构](#uri结构)
        - [URI编码](#uri编码)
    - [HTTP 状态码](#http-状态码)
        - [1XX状态码](#1xx状态码)
        - [2XX状态码](#2xx状态码)
        - [3XX状态码](#3xx状态码)
        - [4XX状态码](#4xx状态码)
        - [5XX状态码](#5xx状态码)
    - [HTTP特点](#http特点)
        - [HTTP缺点](#http缺点)

<!-- /TOC -->

## HTTP的报文结构

HTTP请求报文&响应报文

头部的图片为：

![请求报文头部](https://user-gold-cdn.xitu.io/2020/3/22/170ffd6012e2fc88?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

![响应报文头部](https://user-gold-cdn.xitu.io/2020/3/22/170ffd62af8538e4?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

```JS
起始行 + 头部 + 空行 + 实体
```

### 起始行

请求报文的起始行类似:

```JS
GET /home HTTP/1.1
```

方法+路径+HTTP版本

响应报文的起始行：

```JS
HTTP/1.1 200 OK
```

http版本+状态码+原因

均要以CRLF 回车换行为结尾

### 头部

```JS
field name: filed value CRLF
```

### 空行

用来区分头部与实体

### 实体

## HTTP请求方法

### 常见方法

HTTP/1.1规定了以下方法

- GET: 通常用来获取资源
- HEAD: 获取资源的元信息
- POST: 提交数据，即上传数据
- PUT: 修改数据
- DELETE: 删除资源(几乎用不到)
- CONNECT: 建立连接隧道，用于代理服务器
- OPTIONS: 列出可对资源实行的请求方法，用来跨域请求
- TRACE: 追踪请求-响应的传输路径

### GET与POST区别

- GET会被主动缓存下来，POST不行
- GET只能进行URL编码
- GET传参只能通过url传，不安全，且大小有限制
- GET是幂等的，POST不是
- GET会把请求一次性发送，POST会分为两个TCP数据包，首先发header部分，如果服务器响应 100(continue)， 然后发body部分。(火狐浏览器除外，它的POST请求只发一个TCP包)

## URI

URI, 全称为(Uniform Resource Identifier), 也就是统一资源标识符，它的作用很简单，就是区分互联网上不同的资源。

URI包含了URN和URL。

URN，统一资源名称（Uniform Resource Name）有着严格唯一性约束的URL，URL 统一资源定位符（Uniform Resource Locator）。

### URI结构

![url结构](https://user-gold-cdn.xitu.io/2020/3/22/170ffd677629b70d?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

- scheme: 协议名，比如http, https, file等等。后面必须和://连在一起。
- user: passwd@ 表示登录主机时的用户信息，不过很不安全，不推荐使用，也不常用。
- host:port: 表示主机名和端口。
- path: 请求路径，标记资源所在位置。
- query: 查询参数，为key=val这种形式，多个键值对之间用&隔开。
- fragment: URI 所定位的资源内的一个锚点，浏览器可以根据这个锚点跳转到对应的位置。

### URI编码

URI 只能使用ASCII，将所有非 ASCII 码字符和界定符转为十六进制字节值。

## HTTP 状态码

- 1xx: 表示目前是协议处理的中间状态，还需要后续操作。
- 2xx: 表示成功状态。
- 3xx: 重定向状态，资源位置发生变动，需要重新请求。
- 4xx: 请求报文有误。
- 5xx: 服务器端发生错误。

### 1XX状态码

|  状态码   | 英文  | 含义 |
|  ----    | ----  | ---- |
| 100 | Continue | 继续。客户端应继续其请求 |
| 101 | Switching Protocols | 切换协议。服务器根据客户端的请求切换协议。只能切换到更高级的协议 |

### 2XX状态码

|  状态码   | 英文  | 含义 |
|  ----    | ----  | ---- |
| 200 | OK | 请求成功。一般用于GET与POST请求 |
| 201 | Created | 已创建。成功请求并创建了新的资源 |
| 202 | Accepted | 已接受。已经接受请求，但未处理完成 |
| 203 | Non-Authoritative Information | 表示文档被正常的返回，但是由于正在使用的是文档副本所以某些响应头信息可能不正确。 |
| 204 | No Content | 无内容。服务器成功处理，但未返回内容。在未更新网页的情况下，可确保浏览器继续显示当前文档 |
| 205 | Reset Content | 重置内容。服务器处理成功，用户终端（例如：浏览器）应重置文档视图。可通过此返回码清除浏览器的表单域 |
| 206 | Partial Content	| 部分内容。服务器成功处理了部分GET请求 |

### 3XX状态码

|  状态码   | 英文  | 含义 |
|  ----    | ----  | ---- |
| 301 | Moved Permanently | 永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替 |
| 302 | Found | 临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI |
| 304 | Not Modified | 未修改。缓存命中时使用。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源 |
| 305 | Use Proxy | 使用代理。所请求的资源必须通过代理访问 |

### 4XX状态码

|  状态码   | 英文  | 含义 |
|  ----    | ----  | ---- |
| 400 | Bad Request | 客户端请求的语法错误，服务器无法理解 |
| 403 | Forbidden | 这实际上并不是请求报文出错，而是服务器禁止访问，原因有很多，比如法律禁止、信息敏感 |
| 404 | Not Found | 资源未找到，表示没在服务器上找到相应的资源。|
| 405 | Method Not Allowed | 请求方法不被服务器端允许。|
| 406 | Not Acceptable | 资源无法满足客户端的条件。|

### 5XX状态码

|  状态码   | 英文  | 含义 |
|  ----    | ----  | ---- |
| 500 | Internal Server Error | 服务器内部错误，无法完成请求 |
| 501 | Not Implemented | 服务器不支持请求的功能，无法完成请求 |
| 502 | Bad Gateway | 作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应 |
| 503 | Service Unavailable | 由于超载或系统维护，服务器暂时的无法处理客户端的请求。延时的长度可包含在服务器的Retry-After头信息中 |

## HTTP特点

1. 灵活可扩展，主要体现在两个方面。一个是语义上的自由，只规定了基本格式，比如空格分隔单词，换行分隔字段，其他的各个部分都没有严格的语法限制。另一个是传输形式的多样性，不仅仅可以传输文本，还能传输图片、视频等任意数据，非常方便。

2. 可靠传输。HTTP 基于 TCP/IP，因此把这一特性继承了下来。

3. 请求-应答。也就是一发一收、有来有回， 当然这个请求方和应答方不单单指客户端和服务器之间，如果某台服务器作为代理来连接后端的服务端，那么这台服务器也会扮演请求方的角色。

4. 无状态。这里的状态是指通信过程的上下文信息，而每次 http 请求都是独立、无关的。

### HTTP缺点

- 无状态

所谓的优点和缺点还是要分场景来看的，对于 HTTP 而言，最具争议的地方在于它的无状态。
在需要长连接的场景中，需要保存大量的上下文信息，以免传输大量重复的信息，那么这时候无状态就是 http 的缺点了。
但与此同时，另外一些应用仅仅只是为了获取一些数据，不需要保存连接上下文信息，无状态反而减少了网络开销，成为了 http 的优点。

- 明文传输
  
即协议里的报文(主要指的是头部)不使用二进制数据，而是文本形式。
这当然对于调试提供了便利，但同时也让 HTTP 的报文信息暴露给了外界，给攻击者也提供了便利。WIFI陷阱就是利用 HTTP 明文传输的缺点，诱导你连上热点，然后疯狂抓你所有的流量，从而拿到你的敏感信息。

- 队头阻塞问题

当 http 开启长连接时，共用一个 TCP 连接，同一时刻只能处理一个请求，那么当前请求耗时过长的情况下，其它的请求只能处于阻塞状态。